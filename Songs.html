<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Співанник</title>
    <style>
        /* --- CSS STYLES --- */
        :root {
            --primary: #2563eb;
            --bg-body: #f8fafc;
            --bg-card: #ffffff;
            --text-main: #0f172a;
            --text-sec: #64748b;
            --border: #e2e8f0;
            --shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .dark {
            --primary: #3b82f6;
            --bg-body: #0f172a;
            --bg-card: #1e293b;
            --text-main: #f1f5f9;
            --text-sec: #94a3b8;
            --border: #334155;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.5);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            background-color: var(--bg-body);
            color: var(--text-main);
            transition: background-color 0.3s, color 0.3s;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Layout */
        header {
            background-color: var(--primary); /* Blue for Light Mode */
            color: white;
            padding: 12px 16px;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .dark header {
            background-color: #1e293b; /* Slate-800 for Dark Mode */
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            width: 100%;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        /* Components */
        .icon-btn {
            background: none;
            border: none;
            color: inherit;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .icon-btn:active { background-color: rgba(255,255,255,0.2); }

        .search-bar {
            position: relative;
            margin-top: 10px;
        }
        .search-input {
            width: 100%;
            padding: 10px 40px 10px 40px;
            border-radius: 8px;
            border: none;
            outline: none;
            font-size: 16px;
            background: white;
            color: #333;
        }
        .dark .search-input { background: #334155; color: white; }
        .search-icon { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); opacity: 0.5; color: #333;}
        .dark .search-icon { color: #ccc; }
        .clear-icon { position: absolute; right: 12px; top: 50%; transform: translateY(-50%); opacity: 0.5; cursor: pointer; color: #333;}
        .dark .clear-icon { color: #ccc; }

        /* List View */
        .song-list { padding: 8px; overflow-y: auto; }
        .song-card {
            background-color: var(--bg-card);
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 8px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 16px;
            cursor: pointer;
        }
        .song-card:active { transform: scale(0.98); }
        
        .song-number {
            width: 40px; height: 40px;
            background-color: rgba(59, 130, 246, 0.1);
            color: var(--primary);
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-weight: bold; font-size: 18px;
            flex-shrink: 0;
        }
        .dark .song-number { background-color: rgba(59, 130, 246, 0.2); }

        .song-info h3 { margin: 0 0 4px 0; font-size: 18px; }
        .song-info p { margin: 0; font-size: 12px; color: var(--text-sec); 
                       display: -webkit-box; -webkit-line-clamp: 1; -webkit-box-orient: vertical; overflow: hidden; }

        /* Song View */
        .song-view { padding: 20px; overflow-y: auto; flex: 1; }
        .song-title { text-align: center; color: var(--primary); margin-bottom: 24px; font-size: 24px; }
        .song-text { white-space: pre-wrap; line-height: 1.6; padding-bottom: 40px; }

        /* Settings */
        .settings-view { background-color: var(--bg-body); min-height: 100%; }
        .setting-row {
            padding: 16px;
            border-bottom: 1px solid var(--border);
        }
        .setting-label { display: flex; align-items: center; margin-bottom: 8px; font-weight: 500; }
        .setting-label svg { margin-right: 10px; }
        
        .toggle-group { display: flex; background: var(--border); padding: 4px; border-radius: 8px; }
        .toggle-btn {
            flex: 1; padding: 8px; border: none; border-radius: 6px; background: transparent; color: var(--text-sec); cursor: pointer;
        }
        .toggle-btn.active { background: var(--bg-card); color: var(--primary); box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
        
        select {
            width: 100%; padding: 8px; border-radius: 6px; border: 1px solid var(--border);
            background: var(--bg-card); color: var(--text-main); font-size: 16px;
        }
        input[type=range] { width: 100%; }

        .hidden { display: none !important; }
        
        /* SVG Icons */
        svg { width: 24px; height: 24px; stroke: currentColor; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; fill: none; }
    </style>
</head>
<body>

    <!-- APP CONTAINER -->
    <div id="app" class="container">
        <!-- Content will be injected by JavaScript -->
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- DATA ---
        const SONGS = [
            {
                id: 1, number: 1, book: "Збірник Відродження",
                versions: {
                    ua: { title: "Благодать", text: "О благодать, спасенний я,\nЗ безодні я прозрів.\nБув мертвий - чую голос я,\nСліпий був - і прозрів.\n\nВ часи тривог і боротьби\nТи помагав мені.\nІ знаю я - в моїй журбі\nТи був при мені." },
                    en: { title: "Amazing Grace", text: "Amazing grace! How sweet the sound\nThat saved a wretch like me!\nI once was lost, but now am found;\nWas blind, but now I see." }
                }
            },
            {
                id: 2, number: 2, book: "Пісні Хвали",
                versions: {
                    ua: { title: "Тиша навкруги", text: "Тиша навкруги, сплять в росі луги,\nТільки ти не спиш, Господа молиш.\nНа колінах ти, в сльозах скорботи,\nЗа мій гріх тяжкий, там в саду один.\n\nПриспів:\nО, Ісусе мій, Ти - Спаситель мій,\nТи за мене страждав, Ти життя віддав,\nЩоб я вічно жив, Господа хвалив,\nО, Ісусе мій, Ти - Спаситель мій." },
                    en: { title: "Silence all around", text: "(English text placeholder...)\nSilence all around, meadows sleep in dew..." }
                }
            },
            {
                id: 3, number: 15, book: "Збірник Відродження",
                versions: {
                    ua: { title: "Великий Бог", text: "Коли я бачу, як на небі синім\nЗорі горять, де Ти шляхи проклав,\nЯк сонце гріє, як у час осінній\nЛист опада, - я славлю Твої діла.\n\nПриспів:\nТоді співає мій дух Тобі:\nВеликий Бог, Великий Бог!\nТоді співає мій дух Тобі:\nВеликий Бог, Великий Бог!" }
                }
            },
            {
                id: 4, number: 4, book: "Молодіжний",
                versions: {
                    ua: { title: "Лиш Тобі", text: "Лиш Тобі, лиш Тобі,\nСлава, Господи, Тобі!\nЗа чудовий Твій світ,\nЗа дарунок життя,\nЛиш Тобі, лиш Тобі слава вся!" }
                }
            },
            {
                id: 5, number: 5, book: "Молодіжний",
                versions: {
                    ua: { title: "Лише Тоді", text: "Лише Тоді, лиш Тобі,\nСлава, Господи, Тобі!\nЗа чудовий Твій світ,\nЗа дарунок життя,\nЛиш Тобі, лиш Тобі слава вся!" }
                }
            }
        ];

        const UI = {
            ua: { appTitle: "Співанник", settings: "Налаштування", search: "Пошук...", appearance: "Вигляд", theme: "Тема", light: "Світла", dark: "Темна", content: "Зміст", songBook: "Книга", allBooks: "Всі книги", sortBy: "Сорт", sortNumber: "№", sortTitle: "А-Я", lang: "Мова", appLang: "Мова меню", songLang: "Мова пісень", size: "Розмір", noRes: "Не знайдено" },
            en: { appTitle: "Songbook", settings: "Settings", search: "Search...", appearance: "Appearance", theme: "Theme", light: "Light", dark: "Dark", content: "Content", songBook: "Book", allBooks: "All", sortBy: "Sort", sortNumber: "#", sortTitle: "A-Z", lang: "Language", appLang: "App Lang", songLang: "Song Lang", size: "Size", noRes: "No results" }
        };

        // --- ICONS (SVG Strings) ---
        const ICONS = {
            music: `<svg viewBox="0 0 24 24"><path d="M9 18V5l12-2v13"></path><circle cx="6" cy="18" r="3"></circle><circle cx="18" cy="16" r="3"></circle></svg>`,
            settings: `<svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>`,
            search: `<svg viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>`,
            x: `<svg viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>`,
            arrowLeft: `<svg viewBox="0 0 24 24"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>`,
            sun: `<svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>`,
            moon: `<svg viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>`,
            type: `<svg viewBox="0 0 24 24"><polyline points="4 7 4 4 20 4 20 7"></polyline><line x1="9" y1="20" x2="15" y2="20"></line><line x1="12" y1="4" x2="12" y2="20"></line></svg>`,
            globe: `<svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>`,
            book: `<svg viewBox="0 0 24 24"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg>`
        };

        // --- STATE ---
        let state = {
            view: 'list', // 'list', 'song', 'settings'
            activeSongId: null,
            searchQuery: '',
            settings: {
                appLang: 'ua',
                songLang: 'ua',
                theme: 'light',
                selectedBook: 'all',
                sortBy: 'number',
                fontSize: 18
            }
        };

        // --- CORE FUNCTIONS ---
        function saveState() {
            // Optional: Save to localStorage so settings persist
            localStorage.setItem('spivannyk-settings', JSON.stringify(state.settings));
        }

        function loadState() {
            const saved = localStorage.getItem('spivannyk-settings');
            if (saved) {
                state.settings = { ...state.settings, ...JSON.parse(saved) };
            }
            applyTheme();
        }

        function applyTheme() {
            if (state.settings.theme === 'dark') document.body.classList.add('dark');
            else document.body.classList.remove('dark');
        }

        function getFilteredSongs() {
            let result = SONGS;
            // Filter Book
            if (state.settings.selectedBook !== 'all') {
                result = result.filter(s => s.book === state.settings.selectedBook);
            }
            // Search
            if (state.searchQuery.trim()) {
                const q = state.searchQuery.toLowerCase();
                result = result.filter(s => {
                    const ver = s.versions[state.settings.songLang] || Object.values(s.versions)[0];
                    if (!ver) return false;
                    return ver.title.toLowerCase().includes(q) || 
                           ver.text.toLowerCase().includes(q) || 
                           s.number.toString().includes(q);
                });
            }
            // Sort
            result.sort((a, b) => {
                if (state.settings.sortBy === 'number') return a.number - b.number;
                const tA = (a.versions[state.settings.songLang]?.title || "").toLowerCase();
                const tB = (b.versions[state.settings.songLang]?.title || "").toLowerCase();
                return tA.localeCompare(tB);
            });
            return result;
        }

        // --- RENDERERS ---
        const app = document.getElementById('app');

        function render() {
            app.innerHTML = '';
            
            if (state.view === 'list') renderList();
            else if (state.view === 'song') renderSong();
            else if (state.view === 'settings') renderSettings();
        }

        function renderList() {
            const t = UI[state.settings.appLang];
            const songs = getFilteredSongs();

            // Header
            const header = document.createElement('header');
            header.innerHTML = `
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <div style="display:flex; align-items:center; gap:10px; font-weight:bold; font-size:20px;">
                        ${ICONS.music} ${t.appTitle}
                    </div>
                    <button class="icon-btn" onclick="setView('settings')">${ICONS.settings}</button>
                </div>
                <div class="search-bar">
                    <div class="search-icon">${ICONS.search}</div>
                    <input type="text" class="search-input" placeholder="${t.search}" 
                           value="${state.searchQuery}" oninput="handleSearch(this.value)">
                    ${state.searchQuery ? `<div class="clear-icon" onclick="handleSearch('')">${ICONS.x}</div>` : ''}
                </div>
            `;
            app.appendChild(header);

            // List
            const listContainer = document.createElement('div');
            listContainer.className = 'song-list';

            if (songs.length === 0) {
                listContainer.innerHTML = `<div style="text-align:center; padding:40px; color:var(--text-sec);">${t.noRes}</div>`;
            } else {
                songs.forEach(song => {
                    const ver = song.versions[state.settings.songLang] || Object.values(song.versions)[0];
                    const card = document.createElement('div');
                    card.className = 'song-card';
                    card.innerHTML = `
                        <div class="song-number">${song.number}</div>
                        <div class="song-info">
                            <h3>${ver.title}</h3>
                            <p>${song.book} • ${ver.text.substring(0, 30).replace(/\n/g, ' ')}...</p>
                        </div>
                    `;
                    card.onclick = () => openSong(song.id);
                    listContainer.appendChild(card);
                });
            }
            app.appendChild(listContainer);
        }

        function renderSong() {
            const song = SONGS.find(s => s.id === state.activeSongId);
            const ver = song.versions[state.settings.songLang] || Object.values(song.versions)[0];
            const isFallback = !song.versions[state.settings.songLang];

            // Header
            const header = document.createElement('header');
            header.style.backgroundColor = state.settings.theme === 'dark' ? '#1e293b' : '#ffffff';
            header.style.color = state.settings.theme === 'dark' ? '#fff' : '#000';
            header.innerHTML = `
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <button class="icon-btn" onclick="setView('list')">${ICONS.arrowLeft}</button>
                    <div style="text-align:center;">
                        <div style="font-weight:bold; font-size:18px;">#${song.number}</div>
                        <div style="font-size:12px; color:var(--text-sec);">${song.book}</div>
                    </div>
                    <button class="icon-btn" onclick="changeFontSize()">${ICONS.type}</button>
                </div>
            `;
            app.appendChild(header);

            // Content
            const content = document.createElement('div');
            content.className = 'song-view';
            content.innerHTML = `
                ${isFallback ? `<div style="background:rgba(234, 179, 8, 0.2); color:#854d0e; padding:8px; border-radius:4px; font-size:12px; text-align:center; margin-bottom:16px;">Переклад відсутній</div>` : ''}
                <h2 class="song-title">${ver.title}</h2>
                <div class="song-text" style="font-size: ${state.settings.fontSize}px;">${ver.text}</div>
            `;
            app.appendChild(content);
        }

        function renderSettings() {
            const t = UI[state.settings.appLang];
            const books = [...new Set(SONGS.map(s => s.book))];

            // Header
            const header = document.createElement('header');
            header.style.backgroundColor = state.settings.theme === 'dark' ? '#1e293b' : '#ffffff';
            header.style.color = state.settings.theme === 'dark' ? '#fff' : '#000';
            header.innerHTML = `
                <div style="display:flex; align-items:center;">
                    <button class="icon-btn" onclick="setView('list')">${ICONS.arrowLeft}</button>
                    <span style="font-weight:bold; margin-left:10px;">${t.settings}</span>
                </div>
            `;
            app.appendChild(header);

            const container = document.createElement('div');
            container.className = 'settings-view';

            // Helpers for settings rows
            const createRow = (icon, label, content) => {
                const row = document.createElement('div');
                row.className = 'setting-row';
                row.innerHTML = `<div class="setting-label">${icon} ${label}</div>`;
                row.appendChild(content);
                return row;
            };

            // Theme
            const themeDiv = document.createElement('div');
            themeDiv.className = 'toggle-group';
            themeDiv.innerHTML = `
                <button class="toggle-btn ${state.settings.theme === 'light' ? 'active' : ''}" onclick="updateSetting('theme', 'light')">${t.light}</button>
                <button class="toggle-btn ${state.settings.theme === 'dark' ? 'active' : ''}" onclick="updateSetting('theme', 'dark')">${t.dark}</button>
            `;
            container.appendChild(createRow(ICONS.sun, t.appearance, themeDiv));

            // Font Size
            const fontDiv = document.createElement('div');
            fontDiv.innerHTML = `<input type="range" min="12" max="32" step="2" value="${state.settings.fontSize}" oninput="updateSetting('fontSize', this.value)">`;
            container.appendChild(createRow(ICONS.type, `${t.size}: ${state.settings.fontSize}px`, fontDiv));

            // Languages
            const langDiv = document.createElement('div');
            langDiv.style.display = 'flex'; langDiv.style.flexDirection = 'column'; langDiv.style.gap = '10px';
            langDiv.innerHTML = `
                <div style="display:flex; justify-content:space-between;">
                    <span>${t.appLang}</span>
                    <select onchange="updateSetting('appLang', this.value)" style="width:120px;">
                        <option value="ua" ${state.settings.appLang === 'ua' ? 'selected' : ''}>Українська</option>
                        <option value="en" ${state.settings.appLang === 'en' ? 'selected' : ''}>English</option>
                    </select>
                </div>
                <div style="display:flex; justify-content:space-between;">
                    <span>${t.songLang}</span>
                    <select onchange="updateSetting('songLang', this.value)" style="width:120px;">
                        <option value="ua" ${state.settings.songLang === 'ua' ? 'selected' : ''}>Українська</option>
                        <option value="en" ${state.settings.songLang === 'en' ? 'selected' : ''}>English</option>
                    </select>
                </div>
            `;
            container.appendChild(createRow(ICONS.globe, t.lang, langDiv));

            // Book Filter & Sort
            const bookDiv = document.createElement('div');
            bookDiv.style.display = 'flex'; bookDiv.style.flexDirection = 'column'; bookDiv.style.gap = '10px';
            
            let bookOptions = `<option value="all" ${state.settings.selectedBook === 'all' ? 'selected' : ''}>${t.allBooks}</option>`;
            books.forEach(b => {
                bookOptions += `<option value="${b}" ${state.settings.selectedBook === b ? 'selected' : ''}>${b}</option>`;
            });

            bookDiv.innerHTML = `
                <select onchange="updateSetting('selectedBook', this.value)">${bookOptions}</select>
                <div class="toggle-group">
                    <button class="toggle-btn ${state.settings.sortBy === 'number' ? 'active' : ''}" onclick="updateSetting('sortBy', 'number')">${t.sortNumber}</button>
                    <button class="toggle-btn ${state.settings.sortBy === 'title' ? 'active' : ''}" onclick="updateSetting('sortBy', 'title')">${t.sortTitle}</button>
                </div>
            `;
            container.appendChild(createRow(ICONS.book, t.content, bookDiv));

            app.appendChild(container);
        }

        // --- ACTIONS ---
        function setView(v) { state.view = v; render(); }
        function openSong(id) { state.activeSongId = id; setView('song'); }
        function handleSearch(val) { state.searchQuery = val; render(); document.querySelector('.search-input').focus(); }
        function updateSetting(key, val) {
            state.settings[key] = (key === 'fontSize') ? parseInt(val) : val;
            saveState();
            if (key === 'theme') applyTheme();
            render();
        }
        function changeFontSize() {
            let s = state.settings.fontSize;
            s = s < 30 ? s + 2 : 14;
            updateSetting('fontSize', s);
        }

        // --- INIT ---
        loadState();
        render();

    </script>
</body>
</html>